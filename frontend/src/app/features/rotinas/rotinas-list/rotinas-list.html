<p-confirmDialog />

<div class="page-header">
  <div class="page-title-block">
    <h1 class="page-title">Lista de rotinas</h1>
  </div>
</div>

<div class="page-toolbar">
  <div class="search-wrapper">
    <i class="pi pi-search search-icon"></i>
    <input
      type="text"
      pInputText
      placeholder="Buscar por código ou nome..."
      class="search-input"
      [formControl]="searchControl"
      (keyup.enter)="applySearch()"
    />
  </div>
  <div class="toolbar-filters">
    <p-dropdown
      [options]="statusOptions"
      [formControl]="statusControl"
      optionLabel="label"
      optionValue="value"
      placeholder="Status"
      [showClear]="false"
      styleClass="status-dropdown"
      (onChange)="applySearch()"
    />
  </div>
  <div class="toolbar-actions">
    <p-button
      label="Nova"
      icon="pi pi-plus"
      size="small"
      severity="primary"
      (onClick)="openCreateDialog()"
    />
  </div>
</div>

<div class="table-card">
  <p-table
    [value]="rotinas()"
    [lazy]="true"
    [paginator]="true"
    [rows]="10"
    [totalRecords]="totalRecords()"
    [loading]="loading()"
    (onLazyLoad)="onLazyLoad($event)"
    [rowsPerPageOptions]="[10, 25, 50, { showAll: 'Todos' }]"
    dataKey="id"
    currentPageReportTemplate="{first} - {last} de {totalRecords}"
    [showCurrentPageReport]="true"
    paginatorTemplate="RowsPerPageDropdown CurrentPageReport PrevPageLink NextPageLink"
    [showFirstLastIcon]="false"
    [paginatorDropdownAppendTo]="'body'"
    styleClass="p-datatable-sm"
  >
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 3rem"></th>
        <th>Código</th>
        <th>Nome</th>
        <th>Path</th>
        <th>Status</th>
        <th style="width: 170px">Ações</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-row>
      <tr>
        <td>
          <i [class]="row.icon || 'pi pi-circle'" class="rotina-icon"></i>
        </td>
        <td><code class="code-cell">{{ row.code }}</code></td>
        <td class="name-cell">{{ row.name }}</td>
        <td>{{ row.path || '-' }}</td>
        <td>
          <span class="status-text">{{ row.active ? 'Ativo' : 'Inativo' }}</span>
        </td>
        <td class="actions-cell">
          <div class="actions-buttons">
            <p-button
              icon="pi pi-pencil"
              [rounded]="true"
              [text]="true"
              severity="secondary"
              size="small"
              (onClick)="openEditDialog(row)"
              pTooltip="Editar"
            />
            <p-button
              icon="pi pi-trash"
              [rounded]="true"
              [text]="true"
              severity="secondary"
              size="small"
              (onClick)="confirmDelete(row)"
              pTooltip="Excluir"
            />
          </div>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="7" class="empty-message">Nenhuma rotina encontrada.</td>
      </tr>
    </ng-template>
    <ng-template pTemplate="loadingbody">
      <tr>
        <td colspan="7" class="loading-message">
          <i class="pi pi-spin pi-spinner"></i> Carregando...
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="paginatorleft">
      <span class="paginator-rows-label">Itens por página:</span>
    </ng-template>
  </p-table>
</div>

<p-dialog
  [header]="editId() ? 'Editar rotina' : 'Nova rotina'"
  [(visible)]="dialogVisible"
  [modal]="true"
  [style]="{ width: '36rem' }"
  [draggable]="false"
  [resizable]="false"
  (onHide)="closeDialog()"
>
  <form [formGroup]="form" class="create-form">
    <div class="form-row">
      <div class="form-field">
        <label for="code">Código</label>
        <input id="code" pInputText formControlName="code" placeholder="produtos:listar" />
        @if (form.get('code')?.invalid && form.get('code')?.touched) {
          <small class="field-error">Código é obrigatório</small>
        }
      </div>
      <div class="form-field">
        <label for="name">Nome</label>
        <input id="name" pInputText formControlName="name" placeholder="Listar produtos" />
        @if (form.get('name')?.invalid && form.get('name')?.touched) {
          <small class="field-error">Nome é obrigatório</small>
        }
      </div>
    </div>
    <div class="form-row">
      <div class="form-field">
        <label for="icon">Ícone (opcional)</label>
        <input id="icon" pInputText formControlName="icon" placeholder="pi pi-list" />
      </div>
      <div class="form-field">
        <label for="path">Path (opcional)</label>
        <input id="path" pInputText formControlName="path" placeholder="/produtos" />
      </div>
    </div>
    <div class="form-row">
      <div class="form-field form-field-checkbox">
        <p-checkbox formControlName="active" [binary]="true" inputId="active" />
        <label for="active">Ativo</label>
      </div>
      <div class="form-field"></div>
    </div>
  </form>
  <ng-template pTemplate="footer">
    <p-button label="Cancelar" [text]="true" (onClick)="closeDialog()" />
    <p-button
      [label]="editId() ? 'Salvar' : 'Cadastrar'"
      icon="pi pi-check"
      (onClick)="submit()"
      [loading]="saving()"
      [disabled]="form.invalid"
    />
  </ng-template>
</p-dialog>

